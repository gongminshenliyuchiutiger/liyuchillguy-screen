<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiyuChillGuyËû¢ÂπïÈ°ØÁ§∫Á≥ªÁµ±</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a90e2;
            --accent-color: #ff5f57;
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(255, 255, 255, 0.6);
            --shadow-lg: 0 15px 35px rgba(0,0,0,0.15);
            --shadow-sm: 0 5px 15px rgba(0,0,0,0.08);
            --text-main: #2c3e50;
            --radius-lg: 16px;
            --radius-sm: 8px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        /* ÂÖÅË®±ÁâπÂÆöÂçÄÂüüÈÅ∏ÂèñÊñáÂ≠ó (Â¶ÇËº∏ÂÖ•Ê°Ü) */
        input, textarea, [contenteditable] {
            user-select: text;
            cursor: text;
        }

        body {
            font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
            background: url('background/background001.png') no-repeat center center fixed;
            background-size: cover;
            background-color: #eef2f5;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            position: relative;
            transition: background-image 0.5s ease, background-color 0.5s ease;
        }

        /* --- Â∑•‰ΩúÂçÄÂüü --- */
        #workspace {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none; /* ËÆìÈªûÊìäÁ©øÈÄèÂà∞Áï´Â∏É */
        }

        /* --- Â∫ïÈÉ®Â∑•ÂÖ∑Âàó --- */
        .toolbar-wrapper {
            position: relative;
            margin-bottom: 30px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            pointer-events: auto;
        }

        .toolbar-wrapper.minimized { transform: translateY(120%); }

        .toggle-bar-btn {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            color: var(--text-main);
            font-size: 18px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s;
        }
        .toggle-bar-btn:hover { background: white; color: var(--primary-color); }

        .toolbar-container {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 12px 25px;
            box-shadow: var(--shadow-lg);
            display: flex;
            gap: 12px;
            overflow-x: auto;
            max-width: 90vw;
            scrollbar-width: none;
        }
        .toolbar-container::-webkit-scrollbar { display: none; }

        .tool-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            color: #555;
            min-width: 60px;
            transition: all 0.2s;
        }
        .tool-btn:active { transform: scale(0.92); }
        .tool-btn:hover { color: var(--primary-color); }
        .tool-btn.danger:hover { color: var(--accent-color); }

        .tool-icon {
            font-size: 20px;
            margin-bottom: 6px;
            background: rgba(255,255,255,0.6);
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid transparent;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        .tool-btn:hover .tool-icon { background: #fff; transform: translateY(-3px); box-shadow: 0 5px 10px rgba(0,0,0,0.1); }
        .tool-label { font-size: 12px; font-weight: 600; white-space: nowrap;}

        /* ËÉåÊôØÈÅ∏ÂñÆ */
        .bg-menu {
            display: none;
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 8px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            flex-direction: column;
            gap: 4px;
            z-index: 200;
            min-width: 140px;
        }
        .bg-menu.show { display: flex; animation: fadeInUp 0.2s; }
        @keyframes fadeInUp { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
        .bg-option { padding: 8px 12px; cursor: pointer; font-size: 13px; border-radius: 6px; color: #333; }
        .bg-option:hover { background: #f0f4f8; color: var(--primary-color); font-weight: bold; }

        /* --- Widget Ë¶ñÁ™óÊ®£Âºè --- */
        .widget {
            position: absolute;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            min-width: 250px;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            pointer-events: auto;
            animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 10;
            border: 1px solid var(--glass-border);
            resize: both;
            overflow: hidden;
        }
        @keyframes popIn { from { transform: scale(0.9) translateY(20px); opacity: 0; } to { transform: scale(1) translateY(0); opacity: 1; } }

        .widget-header {
            padding: 10px 15px;
            background: rgba(248, 249, 250, 0.5);
            cursor: grab;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            flex-shrink: 0;
        }
        .widget-header:active { cursor: grabbing; }
        .widget-title { font-size: 13px; color: #666; font-weight: 700; letter-spacing: 1px; }
        .header-controls { display: flex; gap: 8px; align-items: center; }
        .ctrl-btn { cursor: pointer; color: #999; font-size: 14px; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: 0.2s; }
        .ctrl-btn:hover { background: rgba(0,0,0,0.05); color: var(--primary-color); }
        .close-btn:hover { background: #ff5f57; color: white; }

        .widget-content {
            flex: 1;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: auto;
            width: 100%;
            height: 100%;
            position: relative;
            cursor: default; 
        }
        .widget-content::-webkit-scrollbar { width: 6px; height: 6px; }
        .widget-content::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 3px; }

        /* --- Traffic Light --- */
        .traffic-container { display: flex; flex-direction: column; gap: 8px; width: 100%; transition: 0.3s; padding-bottom: 10px;}
        .traffic-row { 
            display: flex; align-items: center; gap: 10px; 
            background: rgba(255,255,255,0.5); padding: 5px 10px; border-radius: 30px; 
            transition: all 0.2s;
        }
        .traffic-row.dragging { opacity: 0.5; border: 2px dashed #999; }
        .drag-handle { cursor: grab; color: #aaa; font-size: 14px; padding: 0 5px; }
        .light { width: 40px; height: 40px; border-radius: 50%; opacity: 0.3; cursor: pointer; border: 2px solid rgba(0,0,0,0.1); transition: all 0.3s; flex-shrink: 0; box-shadow: inset 0 2px 5px rgba(0,0,0,0.1); }
        .light.active { opacity: 1; transform: scale(1.1); box-shadow: 0 0 15px currentColor, inset 0 -5px 10px rgba(0,0,0,0.2); border-color: transparent;}
        .traffic-input { flex: 1; border: none; padding: 5px; font-size: 16px; background: transparent; color: var(--text-main); font-weight: 500; min-width: 0; }
        .traffic-del { cursor: pointer; color: #ccc; font-size: 14px; padding: 5px; transition: 0.2s; }
        .traffic-del:hover { color: #ff5f57; }

        .traffic-hide-text .traffic-input,
        .traffic-hide-text .traffic-del,
        .traffic-hide-text .drag-handle { display: none; }
        .traffic-hide-text .traffic-row { background: transparent; width: fit-content; margin: 0 auto; padding: 0; gap: 0; }
        .traffic-hide-text .light { margin: 5px 0; width: 60px; height: 60px; }

        .add-light-btn { font-size: 13px; color: #666; background: rgba(255,255,255,0.6); border: 1px solid rgba(0,0,0,0.1); padding:6px 12px; border-radius:20px; cursor: pointer; align-self: center; margin-top: 5px; transition: 0.2s;}
        .add-light-btn:hover { background: white; color: var(--primary-color); }

        /* --- Text Editor --- */
        .text-toolbar { display: flex; gap: 4px; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 8px; width: 100%; flex-wrap: wrap; align-items: center;}
        .text-btn { background: white; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; min-width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; font-size: 13px; color: #555; padding: 0 5px;}
        .text-btn:hover { background: #f0f0f0; color: var(--primary-color); }
        .text-select { height: 28px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; color: #333; background: white; outline: none; }
        
        .text-editor { 
            width: 100%; height: 100%; min-height: 120px; overflow-y: auto; outline: none; cursor: text; 
            font-size: 18px; line-height: 1.5; padding: 10px; color: #333; background: transparent;
        }
        /* Placeholder ÂØ¶‰Ωú */
        .text-editor:empty:before {
            content: attr(placeholder);
            color: #aaa;
            font-style: italic;
            pointer-events: none; /* ËÆìÈªûÊìäÁ©øÈÄè */
            display: block; /* Á¢∫‰øùÈ°ØÁ§∫ */
        }
        /* Áï∂Ë¢´ËÅöÁÑ¶(focus)ÊôÇÔºåÂç≥‰ΩøÊòØÁ©∫ÁöÑ‰πü‰∏çÈ°ØÁ§∫ placeholder */
        .text-editor:focus:before {
            content: none;
        }

        .text-editor ul, .text-editor ol { margin-left: 20px; padding-left: 10px; }
        .text-editor li { margin-bottom: 4px; }
        .bg-color-picker { width: 20px; height: 20px; border-radius: 50%; cursor: pointer; border: 1px solid rgba(0,0,0,0.1); display: inline-block; margin-left: 5px; }

        /* --- Draw Board --- */
        .draw-wrapper { display: flex; flex-direction: column; align-items: center; width: 100%; height: 100%; }
        .draw-tools { 
            display: flex; gap: 8px; margin-bottom: 10px; background: #fff; padding: 8px 12px; border-radius: 30px; box-shadow: var(--shadow-sm); flex-wrap: wrap; justify-content: center;
        }
        .color-pick { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: 0.2s; position: relative;}
        .color-pick:hover { transform: scale(1.1); }
        .color-pick.active { transform: scale(1.2); border-color: #333; z-index: 2; }
        .tool-separator { width: 1px; height: 20px; background: #ddd; margin: 0 5px; }
        .draw-btn {
            font-size: 14px; color: #666; cursor: pointer; width: 30px; height: 30px; border-radius: 8px; 
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .draw-btn:hover { background: #f0f0f0; color: var(--primary-color); }
        .draw-btn.active { background: var(--primary-color); color: white; }

        .canvas-container { 
            flex: 1; width: 100%; min-height: 200px; position: relative; 
            border: 2px dashed #ccc; border-radius: 10px; overflow: hidden; 
            background-color: white; background-size: 20px 20px;
        }
        .canvas-container.bg-grid { background-image: linear-gradient(#e5e5e5 1px, transparent 1px), linear-gradient(90deg, #e5e5e5 1px, transparent 1px); }
        .canvas-container.bg-lines { background-image: repeating-linear-gradient(0deg, transparent, transparent 29px, #e5e5e5 30px); background-size: 100% 30px;}
        .canvas-container.bg-white { background-image: none; }
        canvas { display: block; touch-action: none; position: absolute; top: 0; left: 0; z-index: 10; cursor: crosshair; }
        .canvas-container.mode-move canvas { pointer-events: none; opacity: 0.6; } 

        .img-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; overflow: hidden; }
        .pasted-img-wrapper {
            position: absolute; display: inline-block; cursor: grab; user-select: none;
            border: 1px solid transparent;
        }
        .pasted-img-wrapper:hover { border: 1px dashed #999; }
        .pasted-img-wrapper.selected { border: 1px solid var(--primary-color); }
        .pasted-img-wrapper img { width: 100%; height: 100%; pointer-events: none; display: block;}
        .resize-handle {
            position: absolute; bottom: -5px; right: -5px; width: 12px; height: 12px;
            background: var(--primary-color); cursor: nwse-resize; border-radius: 50%;
            display: none;
        }
        .pasted-img-wrapper:hover .resize-handle, .pasted-img-wrapper.selected .resize-handle { display: block; }

        /* --- Timer & Stopwatch --- */
        .timer-wrapper { text-align: center; width: 100%; }
        .timer-display { 
            font-size: 4.5rem; font-weight: 700; font-variant-numeric: tabular-nums; 
            margin: 10px 0; display: flex; justify-content: center; align-items: center; gap: 5px;
            font-family: 'Courier New', Courier, monospace; color: #333;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.5);
        }
        .timer-input { 
            width: 110px; font-size: 4.5rem; text-align: center; border: none; background: transparent; 
            color: inherit; font-family: inherit; font-weight: inherit; border-bottom: 2px solid transparent; transition: border 0.3s;
        }
        .timer-input:focus { border-bottom: 2px solid var(--primary-color); }
        .timer-input::-webkit-outer-spin-button, .timer-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .timer-controls { display: flex; gap: 15px; justify-content: center; align-items: center; margin-top: 15px;}
        .timer-btn { 
            padding: 10px 20px; border: none; border-radius: 50px; cursor: pointer; 
            background: var(--primary-color); color: white; font-size: 15px; font-weight: bold;
            box-shadow: 0 4px 10px rgba(74, 144, 226, 0.3); transition: all 0.2s; display: flex; align-items: center; gap: 5px;
        }
        .timer-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(74, 144, 226, 0.4); }
        .timer-btn.reset { background: #e0e0e0; color: #555; box-shadow: none; }

        .random-result { font-size: 2.5rem; font-weight: 800; color: var(--primary-color); min-height: 60px; margin: 10px 0; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.5); border-radius: 10px; width: 100%; }
        textarea.names-input { width: 100%; flex: 1; border: 1px solid #ddd; border-radius: 8px; padding: 10px; resize: none; font-size: 14px; background: rgba(255,255,255,0.8); }

        /* --- Scoreboard --- */
        .score-container { display: flex; gap: 15px; overflow-x: auto; width: 100%; padding: 10px 5px; align-items: flex-start; }
        .score-team { display: flex; flex-direction: column; align-items: center; background: #fff; padding: 15px; border-radius: 12px; min-width: 120px; position: relative; box-shadow: 0 3px 10px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .score-num { font-size: 3rem; font-weight: 800; margin: 10px 0; color: var(--text-main); line-height: 1; }
        
        /* Ë®òÂàÜÊùøÊåâÈàïÁæéÂåñ */
        .score-actions { display: flex; gap: 10px; margin-top: 5px; }
        .score-ctrl-btn { 
            width: 32px; height: 32px; border-radius: 50%; border: none; 
            background: #f0f0f0; color: #555; font-size: 18px; font-weight: bold;
            cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center;
        }
        .score-ctrl-btn:hover { background: var(--primary-color); color: white; transform: scale(1.1); box-shadow: 0 3px 6px rgba(0,0,0,0.1); }
        
        #mascot {
            position: fixed; bottom: 15px; left: 20px; width: 120px; height: auto; z-index: 150;
            transition: all 0.3s ease; cursor: pointer; filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.3));
        }
        #mascot:hover { filter: drop-shadow(0 0 8px #fff) drop-shadow(0 0 15px #ff00de); transform: scale(1.05) rotate(-5deg); }
        .copyright {
            position: absolute; bottom: 5px; width: 100%; text-align: center; color: rgba(0, 0, 0, 0.4);
            font-size: 11px; z-index: 50; font-weight: 600; font-family: monospace;
        }
    </style>
</head>
<body>

    <div id="workspace"></div>
    <img src="image/LiyuChillGuy.svg" alt="LiyuChillGuy" id="mascot" title="ÊåâÊàë‰∏Ä‰∏ã!">

    <!-- ËÉåÊôØÈÅ∏ÂñÆ -->
    <div id="bgMenu" class="bg-menu">
        <div class="bg-option" onclick="setBg('image', 1)">üñºÔ∏è ËÉåÊôØ 1</div>
        <div class="bg-option" onclick="setBg('image', 2)">üñºÔ∏è ËÉåÊôØ 2</div>
        <div class="bg-option" onclick="setBg('image', 3)">üñºÔ∏è ËÉåÊôØ 3</div>
        <div class="bg-option" onclick="setBg('image', 4)">üñºÔ∏è ËÉåÊôØ 4</div>
        <div class="bg-option" onclick="setBg('image', 5)">üñºÔ∏è ËÉåÊôØ 5</div>
        <hr style="margin: 4px 0; border:0; border-top:1px solid #eee;">
        <div class="bg-option" onclick="setBg('color', '#eef2f5')">üé® Á∞°Á¥ÑÁÅ∞ÁôΩ</div>
        <div class="bg-option" onclick="setBg('color', '#2c3e50')">üåô Ê∑±Ëâ≤Ê®°Âºè</div>
        <div class="bg-option" onclick="setBg('color', '#a8e6cf')">üçÉ Ê∏ÖÊñ∞Á∂†ÊÑè</div>
    </div>

    <div class="toolbar-wrapper" id="toolbarWrapper">
        <div class="toggle-bar-btn" onclick="toggleToolbar()" title="Á∏ÆÂ∞è/Â±ïÈñãÂ∑•ÂÖ∑Âàó">
            <i class="fa-solid fa-chevron-down" id="toggleIcon"></i>
        </div>

        <div class="toolbar-container">
            <div class="tool-btn" id="bgBtn" title="Â∑¶ÈçµÊèõÂúñ / Âè≥ÈçµÈÅ∏ÂñÆ">
                <div class="tool-icon"><i class="fa-solid fa-image"></i></div><span class="tool-label">ËÉåÊôØ</span>
            </div>
            <div class="tool-btn" onclick="createWidget('randomizer')">
                <div class="tool-icon"><i class="fa-solid fa-shuffle"></i></div><span class="tool-label">ÊäΩÁ±§</span>
            </div>
            <div class="tool-btn" onclick="createWidget('text')">
                <div class="tool-icon"><i class="fa-solid fa-font"></i></div><span class="tool-label">ÂÖ¨Âëä</span>
            </div>
            <div class="tool-btn" onclick="createWidget('traffic')">
                <div class="tool-icon"><i class="fa-solid fa-traffic-light"></i></div><span class="tool-label">Á¥ÖÁ∂†Ááà</span>
            </div>
            <div class="tool-btn" onclick="createWidget('timer')">
                <div class="tool-icon"><i class="fa-solid fa-hourglass-half"></i></div><span class="tool-label">ÂÄíÊï∏</span>
            </div>
            <div class="tool-btn" onclick="createWidget('stopwatch')">
                <div class="tool-icon"><i class="fa-solid fa-stopwatch"></i></div><span class="tool-label">Á¢ºÈå∂</span>
            </div>
            <div class="tool-btn" onclick="createWidget('clock')">
                <div class="tool-icon"><i class="fa-regular fa-clock"></i></div><span class="tool-label">ÊôÇÈêò</span>
            </div>
            <div class="tool-btn" onclick="createWidget('calendar')">
                <div class="tool-icon"><i class="fa-solid fa-calendar-days"></i></div><span class="tool-label">Êó•ÊõÜ</span>
            </div>
            <div class="tool-btn" onclick="createWidget('scoreboard')">
                <div class="tool-icon"><i class="fa-solid fa-clipboard-list"></i></div><span class="tool-label">Ë®òÂàÜ</span>
            </div>
            <div class="tool-btn" onclick="createWidget('dice')">
                <div class="tool-icon"><i class="fa-solid fa-dice"></i></div><span class="tool-label">È™∞Â≠ê</span>
            </div>
            <div class="tool-btn" onclick="createWidget('draw')">
                <div class="tool-icon"><i class="fa-solid fa-pen-nib"></i></div><span class="tool-label">Áï´Êùø</span>
            </div>
            <div class="tool-btn danger" onclick="clearAllWidgets()" title="Ê∏ÖÈô§ÊâÄÊúâË¶ñÁ™ó">
                <div class="tool-icon" style="color: #ff5f57;"><i class="fa-solid fa-trash-can"></i></div><span class="tool-label">Ê∏ÖÈô§</span>
            </div>
        </div>
    </div>

    <div class="copyright">Copyright ¬© Liyuchiutiger Gongminshen</div>

    <script>
        const workspace = document.getElementById('workspace');

        // --- Â∑•ÂÖ∑ÂàóÂäüËÉΩ ---
        function toggleToolbar() {
            const wrapper = document.getElementById('toolbarWrapper');
            wrapper.classList.toggle('minimized');
            document.getElementById('toggleIcon').className = wrapper.classList.contains('minimized') ? 'fa-solid fa-chevron-up' : 'fa-solid fa-chevron-down';
        }

        function clearAllWidgets() {
            if(confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÂ∞èÂ∑•ÂÖ∑ÂóéÔºü')) {
                document.querySelectorAll('.widget').forEach(w => w.remove());
            }
        }

        // --- Èü≥ÊïàÁ≥ªÁµ± ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            const t = audioCtx.currentTime;
            
            if (type === 'click') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(800, t); osc.frequency.exponentialRampToValueAtTime(100, t + 0.1);
                gain.gain.setValueAtTime(0.2, t); gain.gain.exponentialRampToValueAtTime(0.01, t + 0.1);
                osc.start(t); osc.stop(t + 0.1);
            } else if (type === 'pop') {
                osc.type = 'triangle'; osc.frequency.linearRampToValueAtTime(600, t + 0.1);
                gain.gain.setValueAtTime(0.2, t); gain.gain.linearRampToValueAtTime(0.01, t + 0.2);
                osc.start(t); osc.stop(t + 0.2);
            } else if (type === 'tada') {
                [523, 659, 783, 1046].forEach((f, i) => {
                    setTimeout(() => {
                        const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
                        o.connect(g); g.connect(audioCtx.destination);
                        o.frequency.value = f; g.gain.setValueAtTime(0.1, audioCtx.currentTime);
                        g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                        o.start(audioCtx.currentTime); o.stop(audioCtx.currentTime + 0.5);
                    }, i * 100);
                });
            }
        }

        // --- ËÉåÊôØÂäüËÉΩ ---
        const bgBtn = document.getElementById('bgBtn');
        const bgMenu = document.getElementById('bgMenu');
        bgBtn.addEventListener('click', () => { setBg('image', (window.bgIdx = (window.bgIdx || 1) % 5 + 1)); });
        bgBtn.addEventListener('contextmenu', (e) => {
            e.preventDefault(); bgMenu.style.left = bgBtn.getBoundingClientRect().left + 'px';
            bgMenu.style.bottom = (window.innerHeight - bgBtn.getBoundingClientRect().top + 10) + 'px';
            bgMenu.classList.add('show');
        });
        document.addEventListener('click', (e) => { if(!bgBtn.contains(e.target) && !bgMenu.contains(e.target)) bgMenu.classList.remove('show'); });
        function setBg(type, val) {
            if(type === 'image') { document.body.style.backgroundImage = `url('background/background00${val}.png')`; window.bgIdx = val; }
            else { document.body.style.backgroundImage = 'none'; document.body.style.backgroundColor = val; }
            bgMenu.classList.remove('show');
        }

        // --- Widget Factory ---
        const titles = { 'randomizer': 'Èö®Ê©üÊäΩÁ±§', 'text': 'ÊñáÂ≠óÂÖ¨Âëä', 'traffic': 'Á¥ÖÁ∂†Ááà', 'timer': 'ÂÄíÊï∏Ë®àÊôÇ', 'stopwatch': 'Á¢ºÈå∂', 'clock': 'ÊôÇÈêò', 'calendar': 'Êó•ÊõÜ', 'scoreboard': 'Ë®òÂàÜÊùø', 'dice': 'Êì≤È™∞Â≠ê', 'draw': 'Áï´Êùø' };

        function createWidget(type) {
            const widget = document.createElement('div');
            widget.className = 'widget';
            widget.style.left = Math.max(50, Math.random()*(window.innerWidth-400)) + 'px';
            widget.style.top = Math.max(50, Math.random()*(window.innerHeight-500)) + 'px';
            
            let extraCtrl = '';
            if(type === 'traffic') extraCtrl = `<div class="ctrl-btn" onclick="toggleTrafficText(this)" title="Èö±ËóèÊñáÂ≠ó"><i class="fa-solid fa-eye"></i></div>`;

            widget.innerHTML = `
                <div class="widget-header">
                    <span class="widget-title">${titles[type] || type}</span>
                    <div class="header-controls">${extraCtrl}<div class="close-btn ctrl-btn" onclick="this.closest('.widget').remove()"><i class="fa-solid fa-xmark"></i></div></div>
                </div>
                <div class="widget-content"></div>`;

            const content = widget.querySelector('.widget-content');
            initWidgetContent(type, content, widget);
            workspace.appendChild(widget);
            makeDraggable(widget);
        }

        function initWidgetContent(type, content, widget) {
            if (type === 'clock') {
                content.innerHTML = `<div style="font-size:3.5rem; font-weight:800; color:var(--text-main); line-height:1; font-family:monospace;" class="clock-display">00:00:00</div>
                                     <div style="font-size:1.2rem; color:#7f8c8d; margin-top:5px;" class="date-display">...</div>`;
                startClock(content); widget.style.width = "340px";
            } 
            else if (type === 'traffic') {
                content.innerHTML = `
                    <div class="traffic-container" id="traffic-${Date.now()}"></div>
                    <button class="add-light-btn" onclick="addTrafficRow(this)">+ Êñ∞Â¢ûÁáàËôü</button>`;
                addTrafficRow(content.querySelector('.add-light-btn'), '#ff5f57', 'Á¶ÅÊ≠¢ / ÂÆâÈùú');
                addTrafficRow(content.querySelector('.add-light-btn'), '#ffbd2e', 'Ê≥®ÊÑè / ËºïËÅ≤');
                addTrafficRow(content.querySelector('.add-light-btn'), '#27c93f', 'ÈñãÂßã / Ë®éË´ñ');
                widget.style.width = "280px";
            } 
            else if (type === 'text') {
                content.innerHTML = `
                    <div class="text-toolbar">
                        <select class="text-select" onchange="formatText(this, 'fontName', this.value)" style="width: 80px;">
                            <option value="Microsoft JhengHei">Ê≠£ÈªëÈ´î</option>
                            <option value="DFKai-SB">Ê®ôÊ•∑È´î</option>
                            <option value="sans-serif">ÈªëÈ´î</option>
                            <option value="serif">ÊòéÈ´î</option>
                            <option value="Comic Sans MS">Âç°Êº´</option>
                        </select>
                        <select class="text-select" onchange="applyFontSize(this, this.value)" style="width: 60px;">
                            <option value="3">Â≠óËôü</option>
                            ${[12,14,16,18,20,24,28,32,36,48,60,72].map(s=>`<option value="${s}">${s}px</option>`).join('')}
                        </select>
                        <button class="text-btn" onclick="formatText(this, 'bold')"><i class="fa-solid fa-bold"></i></button>
                        <button class="text-btn" onclick="formatText(this, 'italic')"><i class="fa-solid fa-italic"></i></button>
                        <button class="text-btn" onclick="formatText(this, 'underline')"><i class="fa-solid fa-underline"></i></button>
                        <button class="text-btn" onclick="formatText(this, 'insertOrderedList')"><i class="fa-solid fa-list-ol"></i></button>
                        <div style="width:1px; height:20px; background:#ddd; margin:0 5px;"></div>
                        <div class="bg-color-picker" style="background:#fff" onclick="setTextBg(this, '#fff')"></div>
                        <div class="bg-color-picker" style="background:#fff740" onclick="setTextBg(this, '#fff740')"></div>
                        <div class="bg-color-picker" style="background:#ccf9ff" onclick="setTextBg(this, '#ccf9ff')"></div>
                    </div>
                    <!-- ‰ΩøÁî® placeholder Â±¨ÊÄß -->
                    <div class="text-editor" contenteditable="true" placeholder="ÈªûÊìäÊ≠§ËôïÈñãÂßãËº∏ÂÖ•..."></div>`;
                widget.style.width = "400px"; widget.style.height = "300px";
            } 
            else if (type === 'draw') {
                content.innerHTML = `
                    <div class="draw-wrapper">
                        <div class="draw-tools">
                            <div class="color-pick active" style="background:black" onclick="setPen(this, 'black')"></div>
                            <div class="color-pick" style="background:#ff5f57" onclick="setPen(this, '#ff5f57')"></div>
                            <div class="color-pick" style="background:#4a90e2" onclick="setPen(this, '#4a90e2')"></div>
                            <div class="tool-separator"></div>
                            <div class="draw-btn" onclick="setPen(this, 'eraser')" title="Ê©°ÁöÆÊì¶"><i class="fa-solid fa-eraser"></i></div>
                            <div class="draw-btn" onclick="clearCanvas(this)" title="Ê∏ÖÁ©∫"><i class="fa-solid fa-trash"></i></div>
                            <div class="tool-separator"></div>
                            <div class="draw-btn" id="moveModeBtn" onclick="toggleMoveMode(this)" title="ÁßªÂãï/Á∏ÆÊîæÂúñÁâá"><i class="fa-solid fa-up-down-left-right"></i></div>
                            <div class="tool-separator"></div>
                            <div class="draw-btn" onclick="setCanvasBg(this, 'bg-white')" title="Á©∫ÁôΩ"><i class="fa-regular fa-square"></i></div>
                            <div class="draw-btn" onclick="setCanvasBg(this, 'bg-grid')" title="ÊñπÊ†º"><i class="fa-solid fa-border-all"></i></div>
                            <div class="draw-btn" onclick="setCanvasBg(this, 'bg-lines')" title="Ê©´Á∑ö"><i class="fa-solid fa-bars"></i></div>
                        </div>
                        <div class="canvas-container bg-white" tabindex="0">
                            <div class="img-layer"></div>
                            <canvas></canvas>
                        </div>
                    </div>`;
                widget.style.width = "500px"; widget.style.height = "400px";
                setTimeout(() => initDraw(content), 100);
            }
            else if (type === 'dice') content.innerHTML = `<div style="font-size:6rem; cursor:pointer; color:var(--primary-color);" onclick="rollDice(this)"><i class="fa-solid fa-dice-one"></i></div>`;
            else if (type === 'timer') {
                content.innerHTML = `
                    <div class="timer-wrapper">
                        <div class="timer-display"><input type="number" value="05" class="timer-input min" onchange="padTime(this)"><span>:</span><input type="number" value="00" class="timer-input sec" onchange="padTime(this)"></div>
                        <div class="timer-controls">
                            <button class="timer-btn" onclick="timerLogic(this)"><i class="fa-solid fa-play"></i> ÈñãÂßã</button>
                            <button class="timer-btn reset" onclick="timerReset(this)"><i class="fa-solid fa-rotate-right"></i></button>
                        </div>
                    </div>`;
                widget.style.width = "320px";
            }
            else if (type === 'stopwatch') {
                content.innerHTML = `<div class="stopwatch-display" style="font-size:3.5rem; font-family:monospace; margin:10px 0;">00:00.00</div>
                    <div class="timer-controls"><button class="timer-btn" onclick="swLogic(this)"><i class="fa-solid fa-play"></i> ÈñãÂßã</button><button class="timer-btn reset" onclick="swReset(this)"><i class="fa-solid fa-rotate-right"></i></button></div>`;
                widget.style.width = "320px";
            }
            else if (type === 'randomizer') {
                content.innerHTML = `<div class="randomizer-area"><div class="random-result"><i class="fa-solid fa-question" style="color:#ccc;"></i></div><textarea class="names-input" placeholder="Ëº∏ÂÖ•ÂêçÂñÆÔºåÊØèË°å‰∏ÄÂÄã..." rows="5"></textarea><button class="timer-btn" style="width:100%; justify-content:center; margin-top:10px;" onclick="runRandomizer(this)">ÈñãÂßãÊäΩÁ±§</button></div>`;
                widget.style.width = "300px";
            }
            else if (type === 'calendar') {
                content.innerHTML = `<div class="cal-container" style="width:100%;"></div>`;
                initCalendar(content.querySelector('.cal-container')); widget.style.width = "300px";
            }
            else if (type === 'scoreboard') {
                content.innerHTML = `<div class="score-container">${createTeamHTML('Á¨¨‰∏ÄÁµÑ')}${createTeamHTML('Á¨¨‰∫åÁµÑ')}</div><button class="add-light-btn" onclick="addTeam(this)">+ Êñ∞Â¢ûÁµÑÂà•</button>`;
                widget.style.width = "400px";
            }
        }

        // --- ÊãñÊõ≥Ë¶ñÁ™óÊ†∏ÂøÉ (‰øÆÂæ©Á∏ÆÊîæË°ùÁ™Å) ---
        function makeDraggable(el) {
            let pos1=0, pos2=0, pos3=0, pos4=0;
            
            el.onmousedown = function(e) {
                // 1. ÊéíÈô§Ëº∏ÂÖ•Ê°Ü„ÄÅÊåâÈàïÁ≠âÂÖÉÁ¥†
                if (['INPUT','TEXTAREA','BUTTON','SELECT','I','CANVAS'].includes(e.target.tagName) || 
                    e.target.classList.contains('light') || 
                    e.target.classList.contains('pasted-img-wrapper') ||
                    e.target.isContentEditable) return;
                
                // 2. Ê™¢Ê∏¨ÊòØÂê¶ÈªûÊìäÂú®Âè≥‰∏ãËßíÁöÑÁ∏ÆÊîæÂçÄÂüü (20x20ÂÉèÁ¥†)
                const rect = el.getBoundingClientRect();
                const isResizeHandle = (e.clientX > rect.right - 20 && e.clientY > rect.bottom - 20);
                
                if (isResizeHandle) {
                    return; // Â¶ÇÊûúÊòØÈªûÊìäÁ∏ÆÊîæÂçÄÔºå‰∏çÂü∑Ë°åÊãñÊõ≥ÔºåËÆìÁÄèË¶ΩÂô®Âü∑Ë°åÂéüÁîüÁ∏ÆÊîæ
                }

                e.preventDefault();
                pos3 = e.clientX; pos4 = e.clientY;
                document.onmouseup = closeDrag;
                document.onmousemove = elementDrag;
                
                document.querySelectorAll('.widget').forEach(w => w.style.zIndex = 10);
                el.style.zIndex = 100;
            };

            function elementDrag(e) {
                e.preventDefault();
                pos1 = pos3 - e.clientX; pos2 = pos4 - e.clientY;
                pos3 = e.clientX; pos4 = e.clientY;
                el.style.top = (el.offsetTop - pos2) + "px";
                el.style.left = (el.offsetLeft - pos1) + "px";
            }
            function closeDrag() { document.onmouseup = null; document.onmousemove = null; }
        }

        // --- Traffic Light ---
        function toggleTrafficText(btn) {
            const container = btn.closest('.widget').querySelector('.traffic-container');
            const isHidden = container.classList.toggle('traffic-hide-text');
            btn.innerHTML = isHidden ? '<i class="fa-solid fa-eye-slash"></i>' : '<i class="fa-solid fa-eye"></i>';
            btn.title = isHidden ? "È°ØÁ§∫ÊñáÂ≠ó" : "Èö±ËóèÊñáÂ≠ó";
        }
        function toggleLight(el) {
            const row = el.parentElement;
            row.parentElement.querySelectorAll('.light').forEach(l => l.classList.remove('active'));
            el.classList.add('active'); playSound('click');
        }
        function addTrafficRow(btn, color=null, text='') {
            const container = btn.previousElementSibling;
            const row = document.createElement('div');
            row.className = 'traffic-row';
            row.draggable = true; 
            
            const colors = ['#9b59b6', '#34495e', '#e67e22', '#1abc9c', '#ff00de'];
            const finalColor = color || colors[Math.floor(Math.random()*colors.length)];
            
            row.innerHTML = `
                <div class="drag-handle" title="ÊãñÊõ≥ÊéíÂ∫è"><i class="fa-solid fa-grip-vertical"></i></div>
                <div class="light" style="background:${finalColor}" onclick="toggleLight(this)"></div>
                <input type="text" class="traffic-input" value="${text}" placeholder="‰∫ãÈ†Ö">
                <div class="traffic-del" onclick="this.parentElement.remove()" title="Âà™Èô§"><i class="fa-solid fa-trash-can"></i></div>
            `;
            
            row.addEventListener('dragstart', e => { row.classList.add('dragging'); });
            row.addEventListener('dragend', e => { row.classList.remove('dragging'); });
            container.addEventListener('dragover', e => {
                e.preventDefault();
                const afterElement = getDragAfterElement(container, e.clientY);
                const dragging = document.querySelector('.dragging');
                if (afterElement == null) container.appendChild(dragging);
                else container.insertBefore(dragging, afterElement);
            });

            container.appendChild(row);
        }
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.traffic-row:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) return { offset: offset, element: child };
                else return closest;
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // --- Text Editor ---
        function formatText(btn, cmd, val=null) {
            document.execCommand(cmd, false, val);
            btn.closest('.widget-content').querySelector('.text-editor').focus();
        }
        function applyFontSize(select, size) {
            const sel = window.getSelection();
            if (sel.rangeCount) {
                const span = document.createElement("span");
                span.style.fontSize = size + "px";
                span.innerHTML = sel.toString();
                const range = sel.getRangeAt(0);
                range.deleteContents();
                range.insertNode(span);
            }
        }
        function setTextBg(btn, color) {
            const ed = btn.closest('.widget-content').querySelector('.text-editor');
            ed.style.background = color; ed.style.borderRadius = color==='#fff'?'0':'8px';
        }

        // --- Draw Board V2 ---
        function initDraw(content) {
            const container = content.querySelector('.canvas-container');
            const canvas = container.querySelector('canvas');
            const imgLayer = container.querySelector('.img-layer');
            const ctx = canvas.getContext('2d');
            let isMoveMode = false;
            
            const resize = () => {
                const temp = document.createElement('canvas'); temp.width=canvas.width; temp.height=canvas.height;
                temp.getContext('2d').drawImage(canvas,0,0);
                canvas.width = container.clientWidth; canvas.height = container.clientHeight;
                ctx.drawImage(temp,0,0);
            };
            new ResizeObserver(resize).observe(container);

            let painting = false, color = 'black', isEraser = false;
            window.setPen = (el, c) => {
                el.parentElement.querySelectorAll('.color-pick, .draw-btn').forEach(x=>x.classList.remove('active'));
                el.classList.add('active');
                
                isMoveMode = false;
                container.classList.remove('mode-move');
                content.querySelector('#moveModeBtn').classList.remove('active');
                
                isEraser = (c === 'eraser');
                if(!isEraser) color = c;
            };
            
            window.clearCanvas = () => { ctx.clearRect(0,0,canvas.width,canvas.height); imgLayer.innerHTML=''; playSound('click'); };
            window.setCanvasBg = (btn, bgClass) => {
                container.classList.remove('bg-white','bg-grid','bg-lines');
                container.classList.add(bgClass);
            };
            window.toggleMoveMode = (btn) => {
                isMoveMode = !isMoveMode;
                btn.classList.toggle('active', isMoveMode);
                container.classList.toggle('mode-move', isMoveMode);
                if(isMoveMode) content.querySelectorAll('.color-pick, .draw-btn[onclick*="setPen"]').forEach(x=>x.classList.remove('active'));
            };

            const getPos = (e) => {
                const rect = canvas.getBoundingClientRect();
                return { x: (e.touches?e.touches[0].clientX:e.clientX)-rect.left, y: (e.touches?e.touches[0].clientY:e.clientY)-rect.top };
            };
            const drawStart = (e) => {
                if(isMoveMode || e.target !== canvas) return;
                painting = true; draw(e);
            };
            const drawEnd = () => { painting = false; ctx.beginPath(); };
            const draw = (e) => {
                if(!painting) return;
                const pos = getPos(e);
                ctx.lineWidth = isEraser ? 25 : 4; ctx.lineCap = 'round'; ctx.strokeStyle = isEraser ? 'rgba(0,0,0,1)' : color;
                ctx.globalCompositeOperation = isEraser ? 'destination-out' : 'source-over';
                ctx.lineTo(pos.x, pos.y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(pos.x, pos.y);
            };
            canvas.addEventListener('mousedown', drawStart); canvas.addEventListener('mousemove', draw);
            window.addEventListener('mouseup', drawEnd);
            canvas.addEventListener('touchstart', drawStart, {passive:false}); canvas.addEventListener('touchmove', draw, {passive:false});

            container.addEventListener('paste', (e) => {
                const items = (e.clipboardData || e.originalEvent.clipboardData).items;
                for (let item of items) {
                    if (item.type.indexOf('image') === 0) {
                        const blob = item.getAsFile();
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            const imgWrapper = document.createElement('div');
                            imgWrapper.className = 'pasted-img-wrapper';
                            imgWrapper.style.left = '10px'; imgWrapper.style.top = '10px'; imgWrapper.style.width = '150px';
                            imgWrapper.innerHTML = `<img src="${event.target.result}"><div class="resize-handle"></div>`;
                            imgLayer.appendChild(imgWrapper);
                            setupImgDrag(imgWrapper);
                            if(!isMoveMode) window.toggleMoveMode(content.querySelector('#moveModeBtn'));
                        };
                        reader.readAsDataURL(blob);
                    }
                }
            });

            function setupImgDrag(el) {
                let startX, startY, startW, startH, startL, startT;
                
                el.onmousedown = (e) => {
                    if(!isMoveMode) return;
                    e.stopPropagation();
                    imgLayer.querySelectorAll('.pasted-img-wrapper').forEach(i=>i.classList.remove('selected'));
                    el.classList.add('selected');

                    if(e.target.classList.contains('resize-handle')) {
                        startX = e.clientX; startY = e.clientY;
                        startW = parseInt(document.defaultView.getComputedStyle(el).width, 10);
                        startH = parseInt(document.defaultView.getComputedStyle(el).height, 10);
                        document.documentElement.addEventListener('mousemove', doResize, false);
                        document.documentElement.addEventListener('mouseup', stopResize, false);
                    } else {
                        startX = e.clientX; startY = e.clientY;
                        startL = el.offsetLeft; startT = el.offsetTop;
                        document.documentElement.addEventListener('mousemove', doMove, false);
                        document.documentElement.addEventListener('mouseup', stopMove, false);
                    }
                };

                function doMove(e) {
                    el.style.left = (startL + e.clientX - startX) + 'px';
                    el.style.top = (startT + e.clientY - startY) + 'px';
                }
                function stopMove() { document.documentElement.removeEventListener('mousemove', doMove); document.documentElement.removeEventListener('mouseup', stopMove); }
                function doResize(e) {
                    el.style.width = (startW + e.clientX - startX) + 'px';
                    el.style.height = (startH + e.clientY - startY) + 'px';
                }
                function stopResize() { document.documentElement.removeEventListener('mousemove', doResize); document.documentElement.removeEventListener('mouseup', stopResize); }
            }
        }

        // --- Clock ---
        function startClock(content) {
            const t = content.querySelector('.clock-display');
            const d = content.querySelector('.date-display');
            setInterval(() => {
                const now = new Date();
                t.innerText = now.toLocaleTimeString('zh-TW', {hour12:false});
                d.innerText = now.toLocaleDateString('zh-TW', {year:'numeric', month:'long', day:'numeric', weekday:'long'});
            }, 1000);
        }

        // --- Common Helpers ---
        function rollDice(el) {
            const icons = ['one','two','three','four','five','six'];
            let count=0, t=setInterval(() => {
                el.innerHTML = `<i class="fa-solid fa-dice-${icons[Math.floor(Math.random()*6)]}"></i>`;
                if(++count>10) { clearInterval(t); playSound('pop'); }
            }, 50);
        }
        function padTime(inp) { inp.value = Math.max(0,parseInt(inp.value)||0).toString().padStart(2,'0'); }
        
        function timerLogic(btn) {
            const wrapper = btn.closest('.timer-wrapper');
            const [min, sec] = wrapper.querySelectorAll('input');
            
            if(wrapper.timerId) { clearInterval(wrapper.timerId); wrapper.timerId=null; btn.innerHTML='<i class="fa-solid fa-play"></i> ÁπºÁ∫å'; }
            else {
                let total = parseInt(min.value)*60 + parseInt(sec.value);
                if(total<=0) return;
                min.disabled=sec.disabled=true; btn.innerHTML='<i class="fa-solid fa-pause"></i> Êö´ÂÅú';
                wrapper.timerId = setInterval(()=>{
                    if(total<=0) {
                        clearInterval(wrapper.timerId); wrapper.timerId=null;
                        min.disabled=sec.disabled=false; btn.innerHTML='<i class="fa-solid fa-play"></i> ÈñãÂßã';
                        wrapper.querySelector('.timer-display').style.color='red'; playSound('tada'); return;
                    }
                    total--; min.value=Math.floor(total/60).toString().padStart(2,'0'); sec.value=(total%60).toString().padStart(2,'0');
                }, 1000);
            }
        }
        function timerReset(btn) {
            const wrapper = btn.closest('.timer-wrapper');
            clearInterval(wrapper.timerId); wrapper.timerId=null;
            const [min, sec] = wrapper.querySelectorAll('input');
            min.disabled=sec.disabled=false; min.value="05"; sec.value="00";
            wrapper.querySelector('.timer-display').style.color='#333';
            wrapper.querySelector('.timer-btn').innerHTML='<i class="fa-solid fa-play"></i> ÈñãÂßã';
        }

        function swLogic(btn) {
            const d = btn.closest('.widget-content');
            const disp = d.querySelector('.stopwatch-display');
            if(!d.sw) d.sw={t:0, e:0, i:null};
            
            if(d.sw.i) { clearInterval(d.sw.i); d.sw.i=null; btn.innerHTML='<i class="fa-solid fa-play"></i> ÁπºÁ∫å'; }
            else {
                d.sw.t = Date.now() - d.sw.e;
                d.sw.i = setInterval(()=>{
                    d.sw.e = Date.now() - d.sw.t;
                    let ms=Math.floor((d.sw.e%1000)/10), s=Math.floor((d.sw.e/1000)%60), m=Math.floor(d.sw.e/60000);
                    disp.innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}.${ms.toString().padStart(2,'0')}`;
                }, 10);
                btn.innerHTML='<i class="fa-solid fa-pause"></i> Êö´ÂÅú';
            }
        }
        function swReset(btn) {
            const d = btn.closest('.widget-content'); clearInterval(d.sw?.i); d.sw={t:0, e:0, i:null};
            d.querySelector('.stopwatch-display').innerText="00:00.00";
            d.querySelector('.timer-btn').innerHTML='<i class="fa-solid fa-play"></i> ÈñãÂßã';
        }

        function runRandomizer(btn) {
            const area = btn.parentElement;
            const names = area.querySelector('textarea').value.split('\n').filter(n=>n.trim());
            if(!names.length) return;
            let c=0; btn.disabled=true;
            const t = setInterval(()=>{
                area.querySelector('.random-result').innerText = names[Math.floor(Math.random()*names.length)];
                if(++c>20) { clearInterval(t); playSound('tada'); btn.disabled=false; }
            }, 80);
        }

        function initCalendar(c) {
            let date = new Date();
            const render = () => {
                const y=date.getFullYear(), m=date.getMonth();
                let h = `<div style="display:flex;justify-content:space-between;margin-bottom:10px;font-weight:bold;">
                    <span onclick="calNav(-1)" style="cursor:pointer">&lt;</span> ${y}Âπ¥${m+1}Êúà <span onclick="calNav(1)" style="cursor:pointer">&gt;</span></div>
                    <div style="display:grid;grid-template-columns:repeat(7,1fr);text-align:center;gap:5px;">`;
                ['Êó•','‰∏Ä','‰∫å','‰∏â','Âõõ','‰∫î','ÂÖ≠'].forEach(d=>h+=`<div style="color:#888;font-size:12px">${d}</div>`);
                for(let i=0;i<new Date(y,m,1).getDay();i++) h+=`<div></div>`;
                const today = new Date();
                for(let i=1;i<=new Date(y,m+1,0).getDate();i++) {
                    const isT = (i===today.getDate() && m===today.getMonth() && y===today.getFullYear()) ? 'background:var(--primary-color);color:white;border-radius:50%;' : '';
                    h+=`<div style="padding:5px;${isT}">${i}</div>`;
                }
                c.innerHTML = h + '</div>';
            };
            window.calNav = (d) => { date.setMonth(date.getMonth()+d); render(); };
            render();
        }

        function createTeamHTML(name) {
            return `
                <div class="score-team">
                    <div class="score-del" style="position:absolute;top:5px;right:8px;cursor:pointer;color:#ccc;" onclick="this.closest('.score-team').remove()">‚úï</div>
                    <input type="text" value="${name}" style="border:none;text-align:center;font-weight:bold;width:100%;background:transparent;margin-bottom:5px;">
                    <div class="score-num">0</div>
                    <div class="score-actions">
                        <button class="score-ctrl-btn" onclick="modScore(this,-1)"><i class="fa-solid fa-minus"></i></button>
                        <button class="score-ctrl-btn" onclick="modScore(this,1)"><i class="fa-solid fa-plus"></i></button>
                    </div>
                </div>`;
        }
        function addTeam(btn) { 
            const container = btn.previousElementSibling;
            // Ë®àÁÆóÁõÆÂâçÊúâÂπæÂÄãÁµÑÂà•‰æÜÊ±∫ÂÆö‰∏ã‰∏ÄÁµÑÁöÑÂêçÁ®±
            const currentCount = container.querySelectorAll('.score-team').length;
            // ‰ΩøÁî®‰∏≠ÊñáÊï∏Â≠óÂ∞çÊáâ (Á∞°ÂñÆËôïÁêÜÂâç10ÁµÑÔºåË∂ÖÈÅéÁî®Êï∏Â≠ó)
            const numMap = ['‰∏Ä','‰∫å','‰∏â','Âõõ','‰∫î','ÂÖ≠','‰∏É','ÂÖ´','‰πù','ÂçÅ'];
            let newName = '';
            if(currentCount < 10) {
                newName = `Á¨¨${numMap[currentCount]}ÁµÑ`;
            } else {
                newName = `Á¨¨${currentCount + 1}ÁµÑ`;
            }
            container.insertAdjacentHTML('beforeend', createTeamHTML(newName)); 
        }
        function modScore(btn, d) { 
            const n = btn.parentElement.previousElementSibling; 
            n.innerText = Math.max(0, parseInt(n.innerText)+d); 
        }

        document.getElementById('mascot').addEventListener('click', () => playSound('tada'));
    </script>
</body>
</html>